name: Weekly Supabase Poke

# to run every Friday 08:00 SGT (00:00 UTC)
on:
  schedule:
    - cron: '0 0 * * 5'
  workflow_dispatch: # allows manual trigger

jobs:
  poke_db:
    runs-on: ubuntu-latest
    steps:
      - name: Send Supabase poke
        run: |
          echo "Poking Supabase DB..."
          # Try up to 3 times with 10-second delay
          for i in {1..3}; do
            STATUS=$(curl -s -o /dev/null -w "%{http_code}" -X GET \
              -H "apikey: ${{ secrets.SUPABASE_ANON_KEY }}" \
              -H "Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}" \
              "https://hfdbwseznikzgeeyjmvf.supabase.co/rest/v1/sessions?select=id&limit=1")
            echo "Attempt $i â†’ HTTP $STATUS"
            if [ "$STATUS" -eq 200 ]; then
              echo "Database awake!"
              break
            fi
            sleep 10
          done
